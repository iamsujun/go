<html>
<body>
<title>Fight</title>
<style type="text/css">
div {
  margin: auto;
	width: 660px;
	height: 360px;
	border: 1px solid #000;
}
ul {
	width: 310px;
	height: 310px;
	padding: 10px;
	border: 0px solid #000;
	float: left;
	list-style: none;
}
li {
	width: 100px;
	height: 100px;
	float: left;
	margin: 1px;
	background: #acacac;
}
.red {
	background: #ff3333;
}
.green {
	background: #99ff66;
}
</style>
<body>
<script type="text/javascript">
function $ (elemId) {
	return document.getElementById(elemId);
}
function createElem (tagName) {
	return document.createElement(tagName);
}

var leftUlElem = createElem( 'ul' );
var liElem = createElem( 'li' );
for (var i = 1, len = 10; i < len; i++) {
	leftUlElem.appendChild( liElem.cloneNode() );
};
var divElem = createElem( 'div' );
var rightUlElem = leftUlElem.cloneNode(1);
leftUlElem.id='leftRoles';
rightUlElem.id='rightRoles';
divElem.appendChild( leftUlElem );
divElem.appendChild( rightUlElem );
document.body.appendChild( divElem );

var timeSpan = createElem( 'span' );
timeSpan.id = 'timeSpan';
document.body.appendChild( timeSpan );

var modelList = {
	1 : [ 5, 6, 5, 7 ],
	2 : [ 11, 7, 5, 7 ],
	3 : [ 9, 8, 5, 7 ],
	4 : [ 7, 6, 5, 7 ]
};
var fightArea = {
	1 : [  ]
}

var leftRoles = {
	0: { 'model': 4, 'life': 300, 'speed': 3, 'fight': 2 },
	5: { 'model': 2, 'life': 300, 'speed': 5, 'fight': 2 },
	7: { 'model': 3, 'life': 300, 'speed': 7, 'fight': 2 }
};
var rightRoles = {
	4: { 'model': 2, 'life': 300, 'speed': 3, 'fight': 2 },
	6: { 'model': 4, 'life': 300, 'speed': 5, 'fight': 2 },
	8: { 'model': 1, 'life': 300, 'speed': 7, 'fight': 2 }
};
var maxTime = 20, dataList = [], positions=[3,0,6,4,1,7,5,2,8];
var len = leftRoles.length, j, have=false;
for (var i = 1; i < maxTime; i++) {
	for ( j in positions ) {
		if ( isset( leftRoles[ j ] ) && i % leftRoles[ j ][ 'speed' ] == 0 ) {
			add( [ 1, j, leftRoles[ j ][ 'model' ], 1 ] );
		};
		if ( isset( rightRoles[ j ] ) && i % rightRoles[ j ][ 'speed' ] == 0 ) {
			add( [ 2, j, rightRoles[ j ][ 'model' ], 1 ] );
		};
	};
};

function findOp (pos, act) {
	switch ( pos  )
	{
		case 1:
		break;
	}
}
function isset (value) {
	return typeof value != 'undefined';
}
function add(data){
	dataList.push( data );
}

var currSec=0, baseSpeed=100, currData;
function debug (value) {
	console.debug( value );
}

function play () {
	if ( currSec >= dataList.length ) {
		return;
	};
	currData = dataList[ currSec ];
	currSec++;
	timeSpan.innerHTML = currSec;
	playFrame();
}
function playFrame () {
	playModel( currData[ 0 ], currData[ 1 ], currData[ 2 ], currData[ 3 ] );
}
function clearFrame() {
	playModel( currData[ 0 ], currData[ 1 ], currData[ 2 ], 0 );
}
play();

function playModel (pos,index, modelId, act) {
	var objs = { 1: leftUlElem, 2 : rightUlElem };
	var obj = objs[ pos ].childNodes[ index ];
	var colors = { 0: '', 1 : 'red', 2: 'green' };
	obj.className = colors[act];
	obj.innerHTML = '';
	if ( act > 0 ) {
		var n=0, sign = setInterval( function(){
			obj.innerHTML = n;
			if ( n++ >= modelList[ modelId ][ act ] ) {
				clearInterval( sign );
				clearFrame();
				play();
			};
		}, baseSpeed );
	};
}
</script>
</body>
</body>
</html>
